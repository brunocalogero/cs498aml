--
output:
  html_document:
    theme: readable
    toc: yes
---
```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
options(scipen=1, digits=4, width=80)
library(faraway)
library(readr)
```
# CS 498 AML Homework 4

## Question 7.9
```{r, message=FALSE}
# preparing data
brunhild <- read_csv("./q1.csv")
```
**(a)**
```{r}
# Making log-log transformed model
brunhild.lm_log = lm(log(Sulfate) ~ 1 + log(Hours), data=brunhild)
plot(log(brunhild$Hours),
	 log(brunhild$Sulfate),
	 main="Regression and points",
	 sub="log log scale",
	 xlab="Predictors",
	 ylab="Results")
abline(brunhild.lm_log, col="red")
```



**(b)**
```{r}
# Making untransforned model
brunhild.lm = lm(Sulfate ~ 1 + Hours, data=brunhild)
plot(brunhild$Hours,
	 brunhild$Sulfate,
	 main="Regression and points",
	 sub="original data",
	 xlab="Predictors",
	 ylab="Results")
abline(brunhild.lm, col="red")
```

**(c)**
```{r}
# Comparing residuaks of the two models
plot(brunhild.lm_log$fitted,
	 brunhild.lm_log$residuals,
	 main="Residuals vs Fitted",
	 sub="log log scale",
	 xlab="Fitted values",
	 ylab="Residuals")

plot(brunhild.lm$fitted,
	 brunhild.lm$residuals,
	 main="Residuals vs Fitted",
	 sub="orignal data",
	 xlab="Fitted values",
	 ylab="Residuals")

```

**(d)**

The range of residuals is much smaller in the the log-log scale model which indicates that it is better. Also the residuals in the original model-data model clearly resemble a pattern. The residuals of the log-log look closer to a normal distribution. This also indicates that the log-log model is better.


## Question 7.10
```{r, message=FALSE}
# preparing data
physical <- read_csv("./q2.csv")
```
**(a)**
```{r}
# Making original model
physical.lm <- lm(Mass ~ 1 + Fore + Bicep + Chest + Neck + Shoulder + Waist + Height + Calf + Thigh + Head, data=physical)
physical.scale = c(min(physical.lm$residuals), max(physical.lm$residuals))
summary(physical.lm)
plot(physical.lm$fitted,
	 physical.lm$residuals,
	 main="Residuls vs Fitted",
	 sub="original data",
	 xlab="Fitted values",
	 ylab="Residuals")
```
**(b)**
From the residuals vs fitted graph, the errors seem to be about normally shaped with a mean of 0.
```{r}
# Making cube root model
physical.lm_trans <- lm((Mass)^(1/3) ~ 1 + Fore + Bicep + Chest + Neck + Shoulder + Waist + Height + Calf + Thigh + Head, data=physical)
summary(physical.lm_trans)

# Comparing residuals of two models
plot(physical.lm_trans$fitted,
	 physical.lm_trans$residuals,
	 main="Residuls vs Fitted",
	 sub="transformed data",
	 xlab="Fitted values",
	 ylab="Residuals")
```

```{r, echo=FALSE}
plot(physical.lm_trans$fitted,
	 physical.lm_trans$residuals,
	 main="Residuls vs Fitted",
	 sub="transformed data, original scale",
	 xlab="Fitted values",
	 ylab="Residuals",
	 ylim=physical.scale)
```

**(c)**

The residuals of the transformed model but on the scale of the orignal model, are really close to 0. Therefore the transformed model is clearly better.


## Question 7.11
```{r, message=FALSE}
# preparing data
abalone <- read_csv("./q3.csv")
```

**(a)**

```{r}
abalone.lm <- lm(age ~ 1 + length + diameter + height + whole_weight + shuckled_weight + viscera_weight + shell_weight + rings, data = abalone)
plot(abalone.lm$fitted,
	 abalone.lm$residuals,
	 main="Residuls vs Fitted",
	 sub="original data",
	 xlab="Fitted values",
	 ylab="Residuals")
```

**(b)**

```{r, message=FALSE}
abalone.with_gender <- read_csv("./q3.csv")
abalone.with_gender[abalone.with_gender["sex"] == "F",]["sex"]<-"-1"
abalone.with_gender[abalone.with_gender["sex"] == "M",]["sex"]<-"1"
abalone.with_gender[abalone.with_gender["sex"] == "I",]["sex"]<-"0"
abalone.with_gender["sex"] = as.numeric(unlist(abalone.with_gender["sex"]))

abalone.lm_gender <- lm(age ~ 1 + sex + length + diameter + height + whole_weight + shuckled_weight + viscera_weight + shell_weight + rings, data = abalone.with_gender)
plot(abalone.lm_gender$fitted,
	 abalone.lm_gender$residuals,
	 main="Residuls vs Fitted",
	 sub="data with gender",
	 xlab="Fitted values",
	 ylab="Residuals")
```


**(c)**

```{r}
abalone.lm_log <- lm(log(age) ~ 1 + length + diameter + height + whole_weight + shuckled_weight + viscera_weight + shell_weight + rings, data = abalone)
plot(abalone.lm_log$fitted,
	 abalone.lm_log$residuals,
	 main="Residuls vs Fitted",
	 sub="log scale, no gender",
	 xlab="Fitted values",
	 ylab="Residuals")
```

**(d)**

```{r}
abalone.lm_gender_log <- lm(log(age) ~ 1 + sex + length + diameter + height + whole_weight + shuckled_weight + viscera_weight + shell_weight + rings, data = abalone.with_gender)
plot(abalone.lm_gender_log$fitted,
	 abalone.lm_gender_log$residuals,
	 main="Residuls vs Fitted",
	 sub="log scale, with gender",
	 xlab="Fitted values",
	 ylab="Residuals")
```

**(f)**

```{r}
library(glmnet)
abalone <- read_csv("./q3.csv")
abalone.with_gender <- abalone

x.without_gender <- model.matrix(log(age) ~ 1 + length + diameter + height + whole_weight + shuckled_weight + viscera_weight + shell_weight + rings, data = abalone)[, -1]

abalone.with_gender <- abalone
abalone.with_gender[abalone.with_gender["sex"] == "F",]["sex"]<-"-1"
abalone.with_gender[abalone.with_gender["sex"] == "M",]["sex"]<-"1"
abalone.with_gender[abalone.with_gender["sex"] == "I",]["sex"]<-"0"
abalone.with_gender["sex"] = as.numeric(unlist(abalone.with_gender["sex"]))

x.with_gender <- model.matrix(log(age) ~ 1 + sex + length + diameter + height + whole_weight + shuckled_weight + viscera_weight + shell_weight + rings, data = abalone.with_gender)

y <- abalone$age

g.with_gender <- glmnet(x.with_gender, y)
g.without_gender <- glmnet(x.without_gender, y)

cvmfit.with_gender = cv.glmnet(x.with_gender, y)
cvmfit.without_gender = cv.glmnet(x.without_gender, y)

plot(g.with_gender, main="Coef with Gender")
plot(cvmfit.with_gender, main="Error with Gender")
plot(g.without_gender, main="Coef without Gender")
plot(cvmfit.without_gender, main="Error without Gender")
```